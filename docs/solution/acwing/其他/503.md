# [503. 借教室](https://www.acwing.com/problem/content/505/)

[[toc]]

## 题目描述

在大学期间，经常需要租借教室。

大到院系举办活动，小到学习小组自习讨论，都需要向学校申请借教室。

教室的大小功能不同，借教室人的身份不同，借教室的手续也不一样。 

面对海量租借教室的信息，我们自然希望编程解决这个问题。

我们需要处理接下来 $n$ 天的借教室信息，其中第i天学校有 $r_i$ 个教室可供租借。

共有 $m$ 份订单，每份订单用三个正整数描述，分别为 $d_j,s_j,t_j$，表示某租借者需要从第 $s_j$ 天到第 $t_j$ 天租借教室（包括第 $s_j$ 天和第 $t_j$ 天），每天需要租借 $d_j$ 个教室。 

我们假定，租借者对教室的大小、地点没有要求。

即对于每份订单，我们只需要每天提供 $d_j$ 个教室，而它们具体是哪些教室，每天是否是相同的教室则不用考虑。 

借教室的原则是先到先得，也就是说我们要按照订单的先后顺序依次为每份订单分配教室。

如果在分配的过程中遇到一份订单无法完全满足，则需要停止教室的分配，通知当前申请人修改订单。

这里的无法满足指从第 $s_j$ 天到第 $t_j$ 天中有至少一天剩余的教室数量不足 $d_j$ 个。 

现在我们需要知道，是否会有订单无法完全满足。

如果有，需要通知哪一个申请人修改订单。

#### 输入格式

第一行包含两个正整数 $n,m$ ，表示天数和订单的数量。 

第二行包含 $n$ 个正整数，其中第 $i$ 个数为 $r_i$，表示第i天可用于租借的教室数量。 

接下来有 $m$ 行，每行包含三个正整数 $d_j,s_j,t_j$，表示租借的数量，租借开始、结束分别在第几天。 

每行相邻的两个数之间均用一个空格隔开。

天数与订单均用从 $1$ 开始的整数编号。

#### 输出格式

如果所有订单均可满足，则输出只有一行，包含一个整数 $0$。

否则（订单无法完全满足）输出两行，第一行输出一个负整数 $-1$，第二行输出需要修改订单的申请人编号。

#### 数据范围

$
1≤n,m≤10^6, \\
0≤r_i,d_j≤10^9, \\
1≤s_j≤t_j≤n
$

#### 输入样例：

    4 3 
    2 5 4 3 
    2 1 3 
    3 2 4 
    4 2 4

#### 输出样例：

    -1 
    2

## 题解

通过不断的租借教室，教室的数量一定是在减少的，这就具有单调性，可以通过二分答案（某一天不能满足订单）来解题。

然后就需要检查当前的二分的答案是否满足条件：

同时不断的在每个区间上加减某数，是差分矩阵的典型问题，使用差分数列来处理，最后通过求前缀和来判断是否存在教室数量小于 $0$ 判断是否满足订单。

- 时间复杂度 $O(n + m)\log m$

二分查找 $O(\log m)$；每次二分使用差分数列求出最终教室数量并验证 $O(n + m)$。

## 参考代码

<<< @/docs/solution/acwing/其他/src/503.借教室.cpp

