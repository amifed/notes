<!DOCTYPE html>

<html>
  <body>
    <pre id="main"></pre>
  </body>
  <script>
    const main = document.querySelector("#main");
    const callback = (i, fn) => () => {
      console.log(i);
      main.innerText += fn(i);
    };
    let i = 1;
    while (i++ < 5000) {
      setTimeout(callback(i, (i) => "\n" + i + "<"));
    }

    while (i++ < 10000) {
      Promise.resolve().then(callback(i, (i) => i + ","));
    }
    console.log(i);
    main.innerText += "[end " + i + " ]\n";
  </script>
</html>
